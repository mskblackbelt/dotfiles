#!/usr/bin/env zsh

set -e

taps=(
  homebrew/python
  homebrew/science
  homebrew/versions
  telemachus/homebrew-desc
  caskroom/cask
  caskroom/versions
  caskroom/fonts
)

brewutils=(
  # Homebrew utilities
  brew-cask
  brew-desc
  brew-gem
  brew-pip
)

packages=(
  # Install Bash4 and Zsh5
  bash
  bash-completion
  zsh
  zsh-completions
  zsh-syntax-highlighting
  zsh-lovers
  
  # Useful binaries
  ack
  ag
  coreutils
  findutils
  fping
  gcc
  gist
  "git --with-brewed-curl --with-brewed-openssl --with-persistent-https"
  git-extras
  gnutls
  htop-osx
  hub
  most
  openssl
#  osxfuse # Not ready for Yosemite at this time. 
  qt
  readline
  smartmontools
  terminal-notifier
  "wget --with-iri"

  # More recent versions of OS X tools
  "vim --override-system-vi"
  homebrew/dupes/grep
  homebrew/dupes/screen
  "homebrew/php/php55 --with-gmp"

  # Text related binaries
  aspell
  emacs
  freetype
  # remember to symlink freetype to freetype2 if matplotlib has errors
  git-latexdiff
  gs
  latex2rtf
  multimarkdown
  pandoc


  # Multimedia binaries
  exiftool
  ffmpeg
  freeimage
  imagemagick
  mplayer
  youtube-dl

  # Misc data-processors and languages
  gnuplot
  octave
  "python --with-brewed-openssl"
  "python3 --with-brewed-openssl"
  r
  ruby
)

cask_packages=(
  # Quick look plugins
  betterzipql
  qlcolorcode
  qlmarkdown
  qlstephen
  quicklook-csv
  scriptql
  suspicious-package

  # Other apps
  appzapper
  audacity
  bartender
  bettertouchtool
  chocolat
  chromium
  cloak
  colloquy
  colorpicker
  colorpicker-hex
  dropbox
  djview
  firefox
  fluid
  flux
  forklift
  github
  google-chrome
  handbrake
  inkscape
  iterm2
  karabiner
  launchbar
  marked
  max
  nvalt
  papers
  pdfpen
  perian
  rstudio
  seil
  silverlight
  skype
  sourcetree
  spotify
  steam
  textmate
  torbrowser
  totalfinder
  totalterminal
  transmission
  twitterrific
  typinator
  vlc
  xquartz

  # These ones are slow  
  mactex
#  parallels9

  # caskroom/fonts
#  font-inconsolata
  font-liberation-sans
  font-open-sans
#  font-source-code-pro
#  font-source-sans-pro
)

function log() {
  echo $* > /dev/stderr
}

#########################################################################

log "brew update"
brew update

log "brew upgrade"
brew upgrade

log "Tapping.."
for name in $taps
do
  log "brew tap ${name}"
  brew tap $name
done

log "Installing Homebrew utilities..."
for name_and_args in $brewutils
do
  log "brew install ${=name_and_args}"
  brew install "${name_and_args}"
done

log "Installing Casks"
for name_and_args in $cask_packages
do
  log "brew cask install ${=name_and_args}"
  brew cask install "${=name_and_args}"
done

log "Installing Brews"
for name_and_args in $packages
do
  log "brew install ${=name_and_args}"
  brew install "${=name_and_args}"
done

log "brew cleanup"
brew cleanup

log "brew linkapps"
brew linkapps

